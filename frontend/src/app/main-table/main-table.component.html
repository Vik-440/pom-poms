<div class="main-table"  *ngIf="orders.length else noData">
  <table class="table table-lg table-bordered mb-0 border-primary">
    <thead>
    <tr class="center-data">
      <th scope="col" sortable="id_order" class="number-order">№ зам.</th>
      <th scope="col" sortable="data_order" class="data-order">Дата замовлення</th>
      <th class="color" scope="col" sortable="kolor_model">Кольори </th>
      <th class="code" scope="col" sortable="kod_model">Код</th>
      <th class="quantity" scope="col" sortable="quantity_pars_model">К-сть</th>
      <th scope="col" sortable="phase_1_model" class="phase"><span>1</span><div>{{ getSumPhases('phase_1') }}</div></th>
      <th scope="col" sortable="phase_2_model" class="phase"><span>2</span><div>{{ getSumPhases('phase_2') }}</div></th>
      <th scope="col" sortable="phase_3_model" class="phase"><span>3</span><div>{{ getSumPhases('phase_3') }}</div></th>
      <th scope="col" sortable="money" class="money">Сума, грн</th>
      <th scope="col" sortable="money" class="phone">№ телефону</th>
      <th class="sity" scope="col" sortable="sity">Місто</th>
      <th scope="col" sortable="data_plane_order" class="data_plane">Дата прогноз</th>
      <th scope="col" sortable="fulfilled_order" class="done">OK</th>
    </tr>
    </thead>
    <tbody>
      <ng-container  *ngFor="let order of orders; let i = index">
        <tr  class="table--row">
          <td [class.yellow]="order.comment_order"  ngxTooltip [tooltipContent]="order.comment_order">
            <a class="clickable" target="_blank" [routerLink]="['/create-order', {id: order.id_order}]">{{ order.id_order }}</a>
          </td>
          <td>{{ order.data_order | date: 'yyyy-MM-dd'}}</td>
          <ng-container *ngIf="isArray(order.kolor_model); else oneItem">
            <td class="td-left">
              <div [id]="'kolorModel-' + j + '-' + i" class="bb_solid" *ngFor="let kolor_model of order.kolor_model; let j = index">
                {{ kolor_model }}
              </div>
            </td>
            <td class="td-left">
              <div class="bb_solid"  [ngStyle]="changeHeight(j, i)" ngxTooltip [tooltipContent]="order.comment_model[i]"  class="bb_solid" [ngClass]="checkCode(kod_model, order.comment_model[i])" *ngFor="let kod_model of order.kod_model; let j = index">
                <a class="clickable" target="_blank" [routerLink]="['/create-order', {codeModel: kod_model}]">{{kod_model}}</a>
              </div>
            </td>
            <td class="pl0">
              <div class="bb_solid" [ngStyle]="changeHeight(j, i)" *ngFor="let quantity_pars_model of order.quantity_pars_model;  let j = index">
                {{quantity_pars_model}}
              </div>
            </td>
            <td class="pl0">
              <div class="bb_solid phases" [ngStyle]="changeHeight(j, i)" *ngFor="let item of order.phase_1; let j = index" [class.green]="item === 0">
                <input (clickOutside)="clickOutside(j, 'phase_1', order, 'phase_1'+ i + j)" type="number" 
                [value]="item" 
                [id]="'phase_1'+ i + j"
                class="phase-input" 
                (click)="changePhases(order, j, 'phase_1', $event, item)" 
                (change)="changePhases(order, j, 'phase_1', $event, item)" 
                (keyup.enter)="sendPhases(order, j, 'phase_1', $event, item)">
              </div>
            </td>
            <td class="pl0">
              <div class="bb_solid phases" [ngStyle]="changeHeight(j, i)" *ngFor="let item of order.phase_2; let j = index" [class.green]="item === 0">
                <input (clickOutside)="clickOutside(j, 'phase_2', order, 'phase_2'+ i + j)" type="number" 
                [value]="item" 
                [id]="'phase_2'+ i + j"
                class="phase-input" 
                (click)="changePhases(order, j, 'phase_2', $event, item)" 
                (change)="changePhases(order, j, 'phase_2', $event, item)" 
                (keyup.enter)="sendPhases(order, j, 'phase_2', $event, item)">
              </div>
            </td>
            <td class="pl0">
              <div class="bb_solid phases" [ngStyle]="changeHeight(j, i)" *ngFor="let item of order.phase_3; let j = index" [class.green]="item === 0">
                <input (clickOutside)="clickOutside(j, 'phase_3', order, 'phase_3'+ i + j)" type="number" 
                [value]="item" 
                [id]="'phase_3'+ i + j"
                class="phase-input" 
                (click)="changePhases(order, j, 'phase_3', $event, item)" 
                (change)="changePhases(order, j, 'phase_3', $event, item)" 
                (keyup.enter)="sendPhases(order, j, 'phase_3', $event, item)">
              </div>
            </td>
          </ng-container>

          <ng-template #oneItem>
             <!-- kolor_model -->
            <td class="td-left pl5">
              {{ order.kolor_model }}
            </td>
            <!-- kod_model -->
            <td class="td-left pl5" ngxTooltip [tooltipContent]="order.comment_model" [class]="checkCode(order.kod_model, order.comment_model)">
              <a class="clickable" target="_blank" [routerLink]="['/create-order', {codeModel: order.kod_model}]">{{order.kod_model}}</a>
            </td>
            <td>
              {{ order.quantity_pars_model }}
            </td>
            <td >
              <input (clickOutside)="clickO(i, 'phase_1', order, phase1)" type="number" 
                    [(value)]="order.phase_1" 
                    class="phase-input"
                    [class.green]="order.phase_1 === 0" 
                    #phase1
                    (click)="changePhase(order, 'phase_1', $event)" 
                    (change)="changePhase(order, 'phase_1', $event)" 
                    (keyup.enter)="sendPhase(order, 'phase_1', $event)">
            </td>
            <td>
              <input type="number"
                    (clickOutside)="clickO(i, 'phase_2', order, phase2)"
                    [(value)]="order.phase_2" 
                    class="phase-input" 
                    [class.green]="order.phase_2 === 0"
                    #phase2
                    (click)="changePhase(order, 'phase_2', $event)"
                    (change)="changePhase(order, 'phase_2', $event)" 
                    (keyup.enter)="sendPhase(order, 'phase_2', $event)">
            </td>
            <td>
              <input type="number" 
                    (clickOutside)="clickO(i, 'phase_3', order, phase3)"
                    [(value)]="order.phase_3" 
                    class="phase-input" 
                    [class.green]="order.phase_3 === 0"
                    #phase3
                    (click)="changePhase(order, 'phase_3', $event)"
                    (change)="changePhase(order, 'phase_3', $event)" 
                    (keyup.enter)="sendPhase(order, 'phase_3', $event)">
            </td>
          </ng-template>

          <td class="td-left pl5" [class]="getColorForMoney(order)">{{ order.sum_payment + ' / ' +( order.real_money || 0) + ' / ' + getMoney((order.sum_payment - order.real_money).toFixed(2))}}</td>
          <td class="td-left pl5 phone-client"> 
            <a class="clickable" target="_blank" [routerLink]="['/create-order', {phoneClient: order.phone_client}]">{{order.phone_client | mask: '00-000-000-00-00' || '-'}}</a> 
          </td>
          <td class="td-left pl5" [class.green]="isHasCity(order.sity)" ngxTooltip [tooltipContent]="tooltipCity(order)">
              <a class="clickable" target="_blank" [routerLink]="['/create-order', {phoneRecipient: order.phone_recipient}]">{{order.sity}}</a> 
          </td>
          <td>{{ order.data_plane_order | date: 'yyyy-MM-dd'}}</td>
          <td>
            <button class="check-btn" (click)="makeDone(order.id_order, !order.fulfilled_order, i)">
              <img class="check-icon" [src]="order.fulfilled_order ? './assets/img/icons/check.svg' : './assets/img/icons/uncheck.svg'" />
            </button>
          </td>
        </tr>
  </ng-container>
    </tbody>
  </table>
</div>
<ng-template #noData>
  <div class="nodata">
    Немає записів
  </div>
</ng-template>

<div *ngIf="isShowSpinner" class="d-flex justify-content-center spinner-wrapper">
  <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true">
    <span class="sr-only">Loading...</span>
  </div>
</div>