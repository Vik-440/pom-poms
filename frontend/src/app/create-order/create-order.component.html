<div class="page pl61 pr50 mt20 create-order__page" >
  <div class="create-order__title">
    <h3 class="create-order__title--number title-text">Замовлення № <input  type="text"></h3>
    <h3 class="create-order__title--date title-text">Дата замовлення
      <ngx-datepicker
      [(ngModel)]="dateToday"
      class="create-order__title--calendar"
      [options]="options"
    ></ngx-datepicker>
    </h3>
  </div>

  <div class="create-order__form mt20" *ngFor="let order of orderForm.controls; let index = index" [formGroup]="order">
    <div class="form__number">
      <input class="number" type="text" readonly [value]="index + 1" disabled>
      <button class="next-btn btn-icon" (click)="addOrder()" [disabled]="orderForm.controls.length - 1 !== index">
        <img class="next-icon icon" src="./assets/img/icons/next.svg" />
      </button>
    </div>

    <!-- 
    form__field ng-select-taggable ng-select-searchable ng-select ng-select-single ng-valid ng-touched ng-dirty ng-select-opened ng-select-bottom
    form__field ng-select-taggable ng-select-searchable ng-select ng-select-single ng-untouched ng-pristine ng-valid
   -->
    <div class="form__fields">
      <ng-select 
        [clearSearchOnAdd]="false" 
        appearance="outline" 
        [items]="kodItems" 
        type="text" 
        class="form__field" 
        [addTag]="true"
        [hideSelected]="true"
        placeholder="код"
        addTagText="+ нова модель"
        formControlName="kod_model" 
        (search)="changeKodModel($event.term, index)" 
        (change)="chooseKode($event, index)">
      </ng-select>
      <input type="text" class="form__field" placeholder="колір помпона" formControlName="kolor_model">
    </div>

    <div class="form__fields">
      <div class="flex">
        <ng-select 
        [clearSearchOnAdd]="false" 
        appearance="outline" 
        [items]="materialsItems" 
        type="text" 
        class="form__field form__field-material" 
        [addTag]="true"
        [hideSelected]="true"
        placeholder="матеріал 1"
        addTagText="+ новий матеріал"
        formControlName="id_color_1" 
        (search)="changeMaterial($event.term, index)" 
        (change)="resetMaterialsItems()">
      </ng-select>
        <!-- <input type="text" class="form__field form__field-material" placeholder="матеріал 1" formControlName="id_color_1"> -->
        <input type="text" class="form__field--sm" placeholder="%" formControlName="id_color_part_1">
      </div>
      <div class="flex">
        <ng-select 
        [clearSearchOnAdd]="false" 
        appearance="outline" 
        [items]="materialsItems" 
        type="text" 
        class="form__field form__field-material" 
        [addTag]="true"
        [hideSelected]="true"
        placeholder="матеріал 3"
        addTagText="+ новий матеріал"
        formControlName="id_color_3" 
        (search)="changeMaterial($event.term, index)" 
        (change)="resetMaterialsItems()">
      </ng-select>
        <input type="text" class="form__field--sm" placeholder="%" formControlName="id_color_part_3">
      </div>
    </div>

    <div class="form__fields">
      <div class="flex">
        <ng-select 
          [clearSearchOnAdd]="false" 
          appearance="outline" 
          [items]="materialsItems" 
          type="text" 
          class="form__field form__field-material" 
          [addTag]="true"
          [hideSelected]="true"
          placeholder="матеріал 2"
          addTagText="+ новий матеріал"
          formControlName="id_color_2" 
          (search)="changeMaterial($event.term, index)" 
          (change)="resetMaterialsItems()">
        </ng-select>
        <input type="text" class="form__field--sm" placeholder="%" formControlName="id_color_part_2">
      </div>
      <div class="flex">
        <ng-select 
        [clearSearchOnAdd]="false" 
        appearance="outline" 
        [items]="materialsItems" 
        type="text" 
        class="form__field form__field-material" 
        [addTag]="true"
        [hideSelected]="true"
        placeholder="матеріал 4"
        addTagText="+ новий матеріал"
        formControlName="id_color_4" 
        (search)="changeMaterial($event.term, index)" 
        (change)="resetMaterialsItems()">
      </ng-select>
        <input type="text" class="form__field--sm" placeholder="%" formControlName="id_color_part_4">
      </div>
    </div>

    <div class="form__fields">
      <input class="form__field--md" type="text" placeholder="ціна" formControlName="price_model">
      <button class="save-btn forms" (click)="saveOrder(index, order)" *ngIf="order.value.isNew">
       Зберегти
      </button>
      <button class="ok-btn forms"  *ngIf="!order.value.isNew">
        <img class="next-icon icon" src="./assets/img/icons/ok-btn.svg" />
       </button>
    </div>

    <div class="form__fields">
        <input type="text" class="form__field--ml" placeholder="к-сть пар" formControlName="quantity_pars_model">
        <input type="text" class="form__field--ml" placeholder="сума" formControlName="sum_pars">
    </div>

    <div class="form__fields">
      <textarea type="text" class="form__field--textarea" placeholder="примітка" formControlName="comment_model"></textarea>
    </div>

    <div class="form__fields">
      <button class="btn-icon" (click)="deleteOrder(index)" [disabled]="orderForm.controls.length <= 1">
        <img class="cancel-icon icon" src="./assets/img/icons/cancel.svg" />
      </button>
    </div>

  </div>
  <div class="sum-up">
    <div class="sum-up--sale">
      <span class="title-text">Знижка </span> <input type="text" class="form__field" placeholder="грн">
    </div>
    <div class="sum-up--all">
      <span class="title-text">Всього </span> 
      <input type="text" [value]="sumAll()" class="form__field" placeholder="___ / ___ / ___">
    </div>
  </div>
  <div class="date-order">
      <div class="date-order-item">
        <p class="date-order-item--title">Прогнозована дата відправки:</p>
        <ngx-datepicker
        [options]="options"
      ></ngx-datepicker>
      </div>
      <button class="btn-icon">
        <img class="next-icon icon" src="./assets/img/icons/refresh.svg" />
      </button>
      <div>
        <p class="date-order-item--title">Бажана дата відправки:</p>
        <ngx-datepicker
        [options]="options"
      ></ngx-datepicker>
      </div>
  
      <button class="btn-icon">
        <img class="next-icon icon" src="./assets/img/icons/send.svg" />
      </button>
  </div>
  <div class="customer" [formGroup]="clientForm">
    <div class="data-customer">
      <ng-select 
        [clearSearchOnAdd]="false" 
        appearance="outline" 
        [items]="clientDataItems" 
        type="text" 
        class="datacustomer--select data-customer--phone" 
        [addTag]="true"
        [hideSelected]="true"
        placeholder="телефон"
        addTagText="+ новий номер телефону"
        formControlName="phone_client"
        (search)="changeClientInfo($event.term, 4, 'ur_phone')" 
        (change)="selectedItemClient($event, 'sl_phone')">
      </ng-select>

      <ng-select 
        [clearSearchOnAdd]="false" 
        appearance="outline" 
        [items]="clientDataItems" 
        type="text" 
        class="datacustomer--select data-customer--lastname" 
        [addTag]="true"
        [hideSelected]="true"
        placeholder="прізвище"
        addTagText="+ прізвище"
        formControlName="second_name_client"
        (search)="changeClientInfo($event.term, 3, 'ur_second_name')" 
        (change)="selectedItemClient($event, 'sl_second_name')">
      </ng-select>
      <input class="data-customer--firstname" type="text" placeholder="ім'я" formControlName="first_name_client">
      <ng-select 
      [clearSearchOnAdd]="false" 
      appearance="outline" 
      [items]="clientDataItems" 
      type="text" 
      class="datacustomer--select data-customer--sity" 
      [addTag]="true"
      [hideSelected]="true"
      placeholder="місто"
      addTagText="+ місто"
      formControlName="sity"
      (search)="changeClientInfo($event.term, 3, 'ur_sity')">
    </ng-select>
      <input class="data-customer--post" type="text" placeholder="№ НП" formControlName="np_number">
      <input class="data-customer--surname" type="text"  placeholder="по-батькові" formControlName="surname_client">
      <input class="data-customer--index" type="text" placeholder="індекс" formControlName="zip_code">
      <input class="data-customer--address" type="text" placeholder="адреса" formControlName="street_house_apartment">
      <input class="data-customer--team" type="text" placeholder="команда" formControlName="name_team">
      <input class="data-customer--coach" type="text" placeholder="тренер" [attr.disabled]="!clientForm.get('coach').value">
    </div>

    <div class="check-person">
      <div class="check-person-btn">
        <span class="cutomer-title">тренер</span>
        <button class="btn-icon">
          <img class="cancel-icon icon" [src]="clientForm.get('coach').value ? './assets/img/icons/check.svg' : './assets/img/icons/cancel.svg'" />
        </button>
        </div>
      <div class="check-person-btn">
        <span class="cutomer-title">отримувач</span>
        <button class="btn-icon" (click)="isRecipient = !isRecipient">
          <img class="cancel-icon icon" [src]="isRecipient ? './assets/img/icons/cancel.svg' : './assets/img/icons/check.svg'" />
        </button></div>
        <button class="mt10 save-btn save-btn--w70" (click)="saveClient()">
          Зберегти
        </button>
    </div>
    <div class="data-customer data-customer-coach" *ngIf="isRecipient">
      <input class="data-customer--phone" type="text" placeholder="телефон">
      <input class="data-customer--lastname" type="text" placeholder="прізвище">
      <input class="data-customer--firstname" type="text" placeholder="ім'я">
      <input class="data-customer--sity" type="text" placeholder="місто">
      <input class="data-customer--post" type="text" placeholder="№ НП">
      <input class="data-customer--surname" type="text"  placeholder="по-батькові">
      <input class="data-customer--index" type="text" placeholder="індекс">
      <input class="data-customer--address" type="text" placeholder="адреса">
      <input class="data-customer--team" type="text" placeholder="команда">
      <button class="data-customer--save save-btn">Зберегти</button>
    </div>
  </div>
  <div class="finished-order">
    <textarea name="" class="finished-order--comment" placeholder="коментар"></textarea>
    <div class="finished-order--btns">
      <button class="finished-order--btn edit">Редагувати</button>
    <button class="finished-order--btn done">Виконано</button>
    <button class="finished-order--btn malachite">Оформити замовлення</button>
    <button class="finished-order--btn teal-blue">Виставити рахунок</button>
    </div>
  </div>
</div>
